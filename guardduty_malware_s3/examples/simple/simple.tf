
module "guardduty_malware_s3" {
  source = "../../"

  s3_bucket_name     = module.scan_bucket.s3_bucket_id
  s3_object_prefixes = ["only-scan-this-folder/"]
  tagging_status     = "ENABLED"

  alarm_sns_topic_alarm_arn = aws_sns_topic.scan_alarm.arn
  alarm_sns_topic_ok_arn    = aws_sns_topic.scan_ok.arn

  billing_tag_value = "testing"
}

module "scan_bucket" {
  source = "../../../S3"

  bucket_name       = "a-bucket-that-will-be-scanned-for-malware"
  billing_tag_value = "testing"
}

resource "aws_sns_topic" "scan_alarm" {
  name = "MalwareS3-Alarm-${module.scan_bucket.s3_bucket_id}"
}

resource "aws_sns_topic" "scan_ok" {
  name = "MalwareS3-Ok-${module.scan_bucket.s3_bucket_id}"
}
